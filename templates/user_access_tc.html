<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Acesso por TC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --border:#e5e7eb; --muted:#6B7280; --text:#002F54; --bg:#f8fafc; --card:#fff; --accent:#22c55e; --accent-weak:#16a34a;}
    body{ margin:0; background:var(--bg); color:var(--text); font-family:ui-sans-serif,system-ui; }
    .wrap{ padding:16px; max-width:1100px; margin:0 auto; }
    h1{ font-size:20px; font-weight:800; margin:8px 4px 16px; }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; margin-bottom:16px; box-shadow:0 4px 16px rgba(0,0,0,.06); }
    .muted{ color:var(--muted); font-size:12px; }
    .cols{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    @media (max-width:900px){ .cols{ grid-template-columns: 1fr; } }
    .box{ border:1px solid var(--border); border-radius:12px; padding:12px; background:#fff; }
    .list{ display:flex; flex-direction:column; gap:8px; max-height:260px; overflow:auto; }
    .row{ display:flex; align-items:center; gap:8px; }
    .btn{ appearance:none; padding:10px 14px; border:1px solid var(--border); border-radius:10px; background:var(--accent); color:#062b16; font-weight:800; cursor:pointer; }
    .btn:hover{ background:var(--accent-weak); }
  </style>
</head>
<body>
  {% include '_navbar.html' %}
  <div class="wrap">
    <h1>Acesso por TC</h1>
    <div class="muted" style="margin:0 4px 16px;">
      Marque os <strong>operadores</strong> (podem iniciar/parar e ver logs) e os <strong>visualizadores</strong> (apenas logs) para cada TC.
      Supervisores e Administradores têm acesso a todas as TCs automaticamente.
    </div>

    {% for ct in tcs %}
    <div class="card">
      <form method="post" action="{{ url_for('user_admin.user_access_by_tc_update', tc_id=ct.id) }}">
        <h3 style="margin:0 0 12px;">TC {{ ct.id }} – {{ ct.name }}</h3>
        <div class="cols">
          <div class="box">
            <div style="font-weight:700; margin-bottom:8px;">Operadores</div>
            <div class="list">
              {% for u in operators %}
              <label class="row">
                {% set checked = (u.id in tc_user_map.get(ct.id, [])) %}
                <input type="checkbox" name="op_user_id" value="{{ u.id }}" {% if checked %}checked{% endif %} />
                <span>{{ u.username }}</span>
              </label>
              {% endfor %}
            </div>
          </div>
          <div class="box">
            <div style="font-weight:700; margin-bottom:8px;">Visualizadores</div>
            <div class="list">
              {% for u in viewers %}
              <label class="row">
                {% set checked = (u.id in tc_user_map.get(ct.id, [])) %}
                <input type="checkbox" name="vw_user_id" value="{{ u.id }}" {% if checked %}checked{% endif %} />
                <span>{{ u.username }}</span>
              </label>
              {% endfor %}
            </div>
          </div>
        </div>
        <div style="margin-top:12px; display:flex; justify-content:flex-end;">
          <button class="btn" type="submit">Salvar TC {{ ct.id }}</button>
        </div>
      </form>
    </div>
    {% endfor %}
  </div>
</body>
</html>
